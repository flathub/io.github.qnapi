app-id: io.github.qnapi
runtime: org.kde.Platform
sdk: org.kde.Sdk
runtime-version: 5.15-25.08
command: qnapi
rename-icon: qnapi
rename-desktop-file: qnapi.desktop
copy-icon: true
finish-args:
  - --socket=wayland
  - --socket=x11
  - --share=ipc
  - --share=network
  - --device=dri
  - --env=TMPDIR=/var/tmp # QtSingleApplication
  - --filesystem=xdg-download
  - --filesystem=xdg-videos
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.freedesktop.Notifications

cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /lib/*.la
  - /share/cmake
  - /share/man
modules:
  - name: p7zip
    no-autogen: true
    sources:
      - type: archive
        url: https://github.com/p7zip-project/p7zip/archive/v17.06/p7zip-v17.06.tar.gz
        sha256: c35640020e8f044b425d9c18e1808ff9206dc7caf77c9720f57eb0849d714cd1
        x-checker-data:
          type: anitya
          project-id: 2583
          stable-only: true
          url-template: https://github.com/p7zip-project/p7zip/archive/v$version/p7zip-v$version.tar.gz
      - type: shell
        commands:
          - sed -i 's|/usr/local|${FLATPAK_DEST}|g' makefile.common
    cleanup:
      - /man

  - name: libzen
    subdir: "Project/GNU/Library"
    config-opts: ["--enable-shared", "--disable-static"]
    sources:
      - type: archive
        url: https://mediaarea.net/download/source/libzen/0.4.38/libzen_0.4.38.tar.xz
        sha256: b8825b3190b3a31d8d362547cfa26a3c10e8c063df2d87e4a05758d6b756c8ab

  - name: libmediainfo
    subdir: "Project/GNU/Library"
    config-opts: ["--enable-shared", "--disable-static", "--with-libcurl"]
    sources:
      - type: archive
        url: https://mediaarea.net/download/source/libmediainfo/20.03/libmediainfo_20.03.tar.xz
        sha256: 6848310eb7050efe7f90f18191dacfcc220c924390b8088fdf0d553274917f72

  - name: qnapi
    buildsystem: qmake
    post-install:
      - install -Dm644 io.github.qnapi.metainfo.xml /app/share/metainfo/io.github.qnapi.metainfo.xml
    sources:
      - type: git
        url: https://github.com/QNapi/qnapi.git
        commit: e8e31be11acbc780f0684bfb32f06736c4fceb85
      - type: patch
        paths:
          - qnapi-pro.patch
          - subdatawidget.patch
      - type: file
        path: io.github.qnapi.metainfo.xml
